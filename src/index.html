<html>
<head>
<title>
o'major
</title>
<meta charset="UTF-8">
<link rel=stylesheet href="style.css">
</head>
<body>
	<div id=container1 style="width: 150px;float: left">
		<button class="tab-button" name="bars">Bars</button>
		<button class="tab-button" name="instruments">Soundfonts</button>
		<button class="tab-button" name="settings">Settings</button>
		<button class="tab-button" name="effects">Effects</button>
		<div class="tab" name="bars" id="bars" hidden>
	
		</div>
		<div class="tab" name="instruments" id="instruments">
	
		</div>
		<div class="tab" name="effects" id=effects hidden>
	
		</div>
		<div class="tab" name="settings" id=settings hidden>
			Bar size: <input type=text id=barLength value=32><br>
		</div>
	</div>
	<canvas id=c width=980 height=600></canvas>
	<nav id=nav>
		<button id="scroll-up">Up</button><br>
		<button id="scroll-down">Down</button><br>
		<button id="scroll-to-start">Start</button><br>
		<button id="scroll-to-end">End</button><br>
	</nav>
	<div style="text-align: right;float: right">
		Note length: <div class="indicator" name="note-length">1</div>
		<input class="indicator-input" name="note-length" type=range min=1 max=32 value=1>
		<button id=aNL>Apply to font</button><br>

		Note volume: <div class="indicator" name="note-volume">100</div>
		<input class="indicator-input" name="note-volume" type=range min=1 max=100 value=100>
		<button id=aNV>Apply to font</button><br>
		Volume curve: <br>
		Type (disabled if silence): <select id=vCurveType>
		
		</select><br>
		Attlitude start: <input id=vCurveStart type=number value=-1><br>
		Attlitude end: <input id=vCurveEnd type=number value=1><br>
		Curve offset (beats): <input id=vCurveOffset type=number value=0><br>
		Cycle time (beats): <input id=vCurveCycle type=number value=32><br>
		<button id=aVC>Apply to font</button>
	</div>
	<div id=menu>
		<button id="play-button" title="Play">&#9654;</button>
		<button id="play-current-bar-button" title="Play current bar">|&#9654;</button>
		<button id="stop-button" title="Stop">&#128306;</button><br>
		<button id="save-button" title="Coming soon" disabled>Save</button><br>
		<button id="load-button" title="Coming soon" disabled>Load</button><br>
		<button id="download-button" title="Download your project state to local device">Download project</button><br>
		<button id="upload-button" title="Please choose file to load the project back" disabled>Upload project</button><br>
		<button id="mp3-convert-button" title="Exports entire song to a mp3 file">Convert to .mp3</button><br>
		<button id="perios-convert-button" title="Used for Peripheral Assassin's bot. If you want to use this bot like that, please ask me for instructions">Convert to PeriOS</button><br>
		<button id="piezo-convert-button" title="Used in one of my private projects, please remove if you clone that code">Convert to piezo</button><br>
		<div id="container2">
			<div class="tab" name="convert-to-mp3"></div>
		</div>
		Save as: <input id="songName" type=text value=song><br>
		Load: <input id=load type=file>
		<div id=urlOut></div>
	</div>
	<div id=strOut>Loading...</div><br>
	<div id=soundFonts>

	</div>
	<script>
		var nl = document.getElementById("nl");
		var nv = document.getElementById("nv");
		//var sel = document.getElementById("sel");
		//sel.oninput = function(evt){console.log(evt)};
		
		document.getElementById("barLength").oninput = function(evt){
			var newVal = parseInt(evt.target.value);
			if(newVal > 0 && newVal !== cfg.bl ){
				rebuildNotes(cfg.bl,newVal);
				cfg.bl = parseInt(evt.target.value) || 32;
			}
		};
		document.getElementById("aNL").onclick = function(){
			var val = parseInt(document.querySelector("input[name=ins]:checked").value || 0);
			var tar = parseInt(document.getElementById("noteLength").value);
			for(var i = 0;i < bars.length;i++){
				var bn = bars[i].notes;
				for(var j = 0;j < bn.length;j++){
					var note = bn[j];
					if(note && (note.instrument == val)){
						note.length = tar;
					}
				}
			}
		};
		document.getElementById("aNV").onclick = function(){
			var val = parseInt(document.querySelector("input[name=ins]:checked").value || 0);
			var tar = parseInt(document.getElementById("noteVolume").value);
			for(var i = 0;i < bars.length;i++){
				var bn = bars[i].notes;
				for(var j = 0;j < bn.length;j++){
					var note = bn[j];
					if(note && (note.instrument == val)){
						note.volume = tar;
					}
				}
			}
		};
		document.getElementById("aVC").onclick = function(){
			var val = parseInt(document.querySelector("input[name=ins]:checked").value || 0);
			var tar1 = document.getElementById("vCurveType").value;
			var tar2 = parseInt(document.getElementById("vCurveStart").value);
			var tar3 = parseInt(document.getElementById("vCurveEnd").value);
			var tar4 = parseInt(document.getElementById("vCurveOffset").value);
			var tar5 = parseInt(document.getElementById("vCurveCycle").value);
			for(var i = 0;i < bars.length;i++){
				var bn = bars[i].notes;
				for(var j = 0;j < bn.length;j++){
					var note = bn[j];
					if(note && (note.instrument == val)){
						note.vCurve = {type: tar1,
						start: tar2,
						end: tar3,
						offset: tar4,
						cycle: tar5,
						};
					}
				}
			}
		};
	</script>
</body>
</html>